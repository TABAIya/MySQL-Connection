# MySQL-Connection
数据库连接池，关于阿里巴巴的Druid的笔记
2023/8/28

晴/28℃

杭州

阿里巴巴主流数据库连接池Druid入门

关联TeD27笔记内容中的数据库连接池

#### 一、数据库连接池的必要性

首先传统的数据库连接模式的步骤为：

1、主程序中创建连接。

这里用JDBC作为示例【连接到数据库，并获得Connection对象】

```java
String url = "jdbc:mysql://localhost:3309/hedu?useSSL=false"+
        "&serverTimeZone=Asia/Shanghai&characterEncoding=utf-8";
String username="root";
String password="root";
```

2、进行sql操作

3、关闭数据库连接【这是一种非常好的习惯，类似于随手关门】



虽然操作非常的简洁，但是同时会发现它的缺陷。

#### 二、常规数据库的连接缺陷

1、过于浪费时间，因为每一次连接都需要验证登录和将con【connection】加载到内存。

2、不能支持大规模的访问数据库，数据库如果访问人数过多后，会占用大量系统资源，导致服务器崩溃。

3、内存泄漏，这里的问题，前提是运行连接后结束任务没有断开服务器，因为没有断开数据库，导致创建的连接对象存在内存中，导致Java内存泄漏的问题。



根据常规的数据库问题，进行了数据库连接池技术的应用。

#### 2.1数据库连接池的思想

顾名思义，连接池就是一个大型的池子，在编程中，它也叫做【缓冲池】，里面存储的事物为【一定数量的连接对象】，需要数据时，就在其中进行调用，结束后就放回池子。

#### 2.2数据库连接池的任务

管理和释放数据库连接，允许用户直接使用池子内的连接对象，不需要进行对象的创建。

#### 2.3数据库连接池的规模

池子的大小决定了存储对象的多少，所以就像建造泳池一般，需要进行初始化数量和最大数量等参数的设置

1、初始化时候的数量：【由数据库最小连接数来设定】

2、最大数量：由最大数据库连接数来确定

3、当连接数超过了最大连接数，超过的连接会停止请求，进行等待操作，直到所需对象被释放。



实际上还是比较容易理解的



#### 2.4数据库连接池的优点

1、资源重用

连接池中对象需要取出的时候，不需要被连接池回收。

【这句话的意思是，在连接池中的对象在被取出并使用后，不需要再被连接池回收。这是因为连接池的目的是为了重用资源，以提高系统的性能和效率。

当一个对象从连接池中被取出时，它通常是一个已经建立好的、可用的资源，例如数据库连接。在使用完该对象后，不需要将其回收到连接池中，而是可以保留在应用程序中供后续使用。

这种资源重用的好处在于，避免了频繁地创建和销毁对象，减少了系统的开销。相反，通过重用资源，可以提高系统的响应速度和效率。

连接池通常会维护一定数量的可用对象，并提供一些管理方法，例如从连接池中取出对象、将对象放回连接池、设置最大连接数等。这样，应用程序可以通过连接池来获取需要的资源，并在使用完毕后将其归还，以供其他请求使用。

总之，资源重用是连接池的一个重要特性，通过避免频繁地创建和销毁对象，可以提高系统的性能和效率。】

2、更快的反应速度

正如上文所述，连接对象已经事先在池中储备，初始化已经完成，可以直接被调用。

3、数据库共享机制

多个用户访问同一数据库，通过位于在应用层的配置，避免资源独占

4、避免内存泄漏

对比起之前需要手动关闭，数据库连接池设置了连接对象时间片，超过时间会被强制回收。



#### 2.5开源的数据库连接池

**JDBC**的数据库连接池用**javax.sql.DataSource**来表示，**DataSource是一个接口**，该接口通常由**服务器提供**。

常见的开源数据库连接池：

DBCP：速度>C3P0 缺点为有bug

C3P0：速度慢  但相对稳定

Proxool：有监控连接池的功能  稳定性<C3P0

BoneCP：速度快

Druid：速度<BoneCP 但是还是比较快的 稳定性好  有监控连接池的功能

#### 德鲁伊数据库连接池参数表

![img](https://img-blog.csdnimg.cn/61b9ae6ca6784ba1866a0e120d215550.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5L2Z5omv,size_20,color_FFFFFF,t_70,g_se,x_16)【可以自己去找】

#### 补充

对于为什么使用数据库连接池和线程池。

我觉得一方面是因为传统数据库的缺点，更多是在于多线程的优点的应用。

因为现实中，使用数据库一般都是多线程任务，每一次创建线程都是占用了资源的，线程的销毁也同样如此，需要再次去进行重复的工作，线程数量过多，会造成系统的负担，同时性能自然会下降，而线程池恰恰可以解决这种问题，可以重复利用已有的线程，减少再次创建线程的开销，提高整体的效率。

#### 阿里巴巴的MySQL连接池和线程池的优点

阿里巴巴的MySQL连接池和线程池的优化技术主要包括以下几个方面

1. 连接池的优化

阿里巴巴的连接池使用HikariCP连接池，其优化的关键在于两点一是预先创建连接，二是使用空闲连接。

预先创建连接在应用启动时，连接池会预先创建一定数量的连接，以便在高并发时快速响应请求。

使用空闲连接连接池会维护一定数量的空闲连接，以便在请求到来时快速分配连接，减少创建连接的开销。

2. 线程池的优化

阿里巴巴的线程池使用ThreadPoolExecutor线程池，其优化的关键在于两点一是合理的线程数，二是任务队列的选择。

合理的线程数线程数过多会造成系统的负担和性能的下降，线程数过少会影响系统的并发能力。阿里巴巴的线程池使用公式线程数 = CPU核数 2 + 1，来确定合理的线程数。

kedBlockingueue任务队列，其可以无限制地添加任务，保证任务不会丢失。

阿里巴巴的MySQL连接池和线程池的优化技术是优化数据库连接的关键技术，其使用预先创建连接、使用空闲连接、合理的线程数和合适的任务队列等方法，可以有效地提高数据库连接和线程的效率。在实际应用中，我们可以根据自己的需求和环境，选择合适的连接池和线程池来优化数据库连接和线程的效率。
